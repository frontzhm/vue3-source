# 4. reactive实现原理

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524160917365.png" alt="image-20230524160917365" style="zoom:50%;" />

## 目标

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524161743924.png" alt="image-20230524161743924" style="zoom:50%;" />

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524161723533.png" alt="image-20230524161723533" style="zoom:50%;" />



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524161916328.png" alt="image-20230524161916328" style="zoom:50%;" />

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524161901577.png" alt="image-20230524161901577" style="zoom:50%;" />



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524162539230.png" alt="image-20230524162539230" style="zoom:50%;" />



## 自己

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524162728745.png" alt="image-20230524162728745" style="zoom:50%;" />



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524162744475.png" alt="image-20230524162744475" style="zoom:50%;" />



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524162907893.png" alt="image-20230524162907893" style="zoom:50%;" />

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524163144948.png" alt="image-20230524163144948" style="zoom:50%;" />



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524164709947.png" alt="image-20230524164709947" style="zoom:50%;" />



### 为啥用receiver

  <img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524165742464.png" alt="image-20230524165742464" style="zoom:50%;" />

希望获取aliasName的时候 name也收集。

因为this.name的this指代的是person，并不是receiver.这样，this指代的就是proxyPerson

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524170405319.png" alt="image-20230524170405319" style="zoom:50%;" />



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524170532072.png" alt="image-20230524170532072" style="zoom:50%;" />



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524170555185.png" alt="image-20230524170555185" style="zoom:50%;" />



### 一个就好

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524170936230.png" alt="image-20230524170936230" style="zoom:50%;" />

代理一次就好。

缓存一般用映射表

但这里特殊，键是对象 

weakMap键必须是对象

![image-20230524171356096](/Users/zhm/Library/Application Support/typora-user-images/image-20230524171356096.png)



### 循环代理

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524171504283.png" alt="image-20230524171504283" style="zoom:50%;" />

以前通过反向映射表，表示代理过

现在，不用反向映射表，如果被代理过，说明被proxy拦截过，

加个标识



<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524172009501.png" alt="image-20230524172009501" style="zoom:50%;" />

<img src="/Users/zhm/Library/Application Support/typora-user-images/image-20230524172022228.png" alt="image-20230524172022228" style="zoom:50%;" />







- 防止重复代理
- 代理过的话，不要循环代理

















 









